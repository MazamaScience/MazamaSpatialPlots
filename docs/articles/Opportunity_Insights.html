<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Opportunity Insights • MazamaSpatialPlots</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Opportunity Insights">
<meta property="og:description" content="MazamaSpatialPlots">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">MazamaSpatialPlots</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.2.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../articles/MazamaSpatialPlots.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/Creating_County_Maps.html">Creating County Maps</a>
    </li>
    <li>
      <a href="../articles/Creating_State_Maps.html">Creating State Maps</a>
    </li>
    <li>
      <a href="../articles/Customizing_State_Maps.html">Customizing State Maps</a>
    </li>
    <li>
      <a href="../articles/Opportunity_Insights.html">Opportunity Insights</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/MazamaScience/MazamaSpatialPlots/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Opportunity Insights</h1>
                        <h4 data-toc-skip class="author">Eli Grosman,
Mazama Science</h4>
            
            <h4 data-toc-skip class="date">February 9, 2020</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/MazamaScience/MazamaSpatialPlots/blob/HEAD/vignettes/articles/Opportunity_Insights.Rmd" class="external-link"><code>vignettes/articles/Opportunity_Insights.Rmd</code></a></small>
      <div class="hidden name"><code>Opportunity_Insights.Rmd</code></div>

    </div>

    
    
<div class="section level2">
<h2 id="objective">Objective<a class="anchor" aria-label="anchor" href="#objective"></a>
</h2>
<p>The goal of this document is to illustrate how
<strong>MazamaSpatialPlots</strong> can be used to easily recreate state
or county level choropleth maps found on the web.</p>
<p>Throughout this document, we will be using data provided by <a href="https://opportunityinsights.org/" class="external-link">Opportunity Insights</a>;
specifically, the data used on their <a href="https://www.tracktherecovery.org/" class="external-link">Economic Tracker</a> web
app.</p>
</div>
<div class="section level2">
<h2 id="obtaining-data">Obtaining Data<a class="anchor" aria-label="anchor" href="#obtaining-data"></a>
</h2>
<p>All of the data we will use is easily obtainable from the Opportunity
Insights <a href="https://github.com/OpportunityInsights/EconomicTracker" class="external-link">GitHub
repository</a>. We can use <code><a href="https://rdrr.io/r/utils/read.table.html" class="external-link">read.csv()</a></code> to load data
directly.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># COVID data by US county</span></span>
<span><span class="va">URL1</span> <span class="op">&lt;-</span> <span class="st">"https://raw.githubusercontent.com/OpportunityInsights/EconomicTracker/main/data/COVID%20-%20County%20-%20Daily.csv.gz"</span></span>
<span><span class="va">URL2</span> <span class="op">&lt;-</span> <span class="st">"https://raw.githubusercontent.com/OpportunityInsights/EconomicTracker/main/data/Zearn%20-%20County%20-%20Weekly.csv"</span></span>
<span><span class="va">countyCovid</span> <span class="op">&lt;-</span> <span class="fu">readr</span><span class="fu">::</span><span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html" class="external-link">read_csv</a></span><span class="op">(</span><span class="va">URL1</span>, col_types <span class="op">=</span> <span class="fu">cols</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">countyMath</span> <span class="op">&lt;-</span> <span class="fu">readr</span><span class="fu">::</span><span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html" class="external-link">read_csv</a></span><span class="op">(</span><span class="va">URL2</span>, col_types <span class="op">=</span> <span class="fu">cols</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">countyCovid</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 6 × 20</span></span></span>
<span><span class="co">##    year month   day countyfips new_cas…¹ new_d…² case_…³ death…⁴ new_c…⁵ case_…⁶</span></span>
<span><span class="co">##   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">1</span>  <span style="text-decoration: underline;">2</span>020     1    21       <span style="text-decoration: underline;">1</span>001 .         .       .       .       .       .      </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">2</span>  <span style="text-decoration: underline;">2</span>020     1    21       <span style="text-decoration: underline;">1</span>003 .         .       .       .       .       .      </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">3</span>  <span style="text-decoration: underline;">2</span>020     1    21       <span style="text-decoration: underline;">1</span>005 .         .       .       .       .       .      </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">4</span>  <span style="text-decoration: underline;">2</span>020     1    21       <span style="text-decoration: underline;">1</span>007 .         .       .       .       .       .      </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">5</span>  <span style="text-decoration: underline;">2</span>020     1    21       <span style="text-decoration: underline;">1</span>009 .         .       .       .       .       .      </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">6</span>  <span style="text-decoration: underline;">2</span>020     1    21       <span style="text-decoration: underline;">1</span>011 .         .       .       .       .       .      </span></span>
<span><span class="co">## <span style="color: #949494;"># … with 10 more variables: new_death_rate &lt;chr&gt;, death_rate &lt;chr&gt;,</span></span></span>
<span><span class="co">## <span style="color: #949494;">#   fullvaccine_count &lt;chr&gt;, booster_first_count &lt;chr&gt;,</span></span></span>
<span><span class="co">## <span style="color: #949494;">#   new_fullvaccine_count &lt;chr&gt;, new_booster_first_count &lt;chr&gt;,</span></span></span>
<span><span class="co">## <span style="color: #949494;">#   new_fullvaccine_rate &lt;chr&gt;, fullvaccine_rate &lt;chr&gt;,</span></span></span>
<span><span class="co">## <span style="color: #949494;">#   new_booster_first_rate &lt;chr&gt;, booster_first_rate &lt;chr&gt;, and abbreviated</span></span></span>
<span><span class="co">## <span style="color: #949494;">#   variable names ¹​new_case_count, ²​new_death_count, ³​case_count,</span></span></span>
<span><span class="co">## <span style="color: #949494;">#   ⁴​death_count, ⁵​new_case_rate, ⁶​case_rate</span></span></span></code></pre>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">countyMath</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 6 × 9</span></span></span>
<span><span class="co">##   countyfips  year month day_endofweek engagement badges break…¹ break…² imput…³</span></span>
<span><span class="co">##        <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>         <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">1</span>       <span style="text-decoration: underline;">1</span>003  <span style="text-decoration: underline;">2</span>019     1            13 -.159      -.165  .       .             1</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">2</span>       <span style="text-decoration: underline;">1</span>003  <span style="text-decoration: underline;">2</span>019     1            20 -.349      -.5    .       .             1</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">3</span>       <span style="text-decoration: underline;">1</span>003  <span style="text-decoration: underline;">2</span>019     1            27 -.4        -.462  .       .             1</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">4</span>       <span style="text-decoration: underline;">1</span>003  <span style="text-decoration: underline;">2</span>019     2             3 .393       .125   .       .             1</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">5</span>       <span style="text-decoration: underline;">1</span>003  <span style="text-decoration: underline;">2</span>019     2            10 .431       .466   .       .             1</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">6</span>       <span style="text-decoration: underline;">1</span>003  <span style="text-decoration: underline;">2</span>019     2            17 .417       .686   .       .             1</span></span>
<span><span class="co">## <span style="color: #949494;"># … with abbreviated variable names ¹​break_engagement, ²​break_badges,</span></span></span>
<span><span class="co">## <span style="color: #949494;">#   ³​imputed_from_cz</span></span></span></code></pre>
<blockquote>
<p>We take a moment here to laud the people making this data available
in a format that contains all the information we need and is easily
ingestible using standard techniques. This kind of <em>open access
data</em> is precisely the kind of data management we hope for in all
publicly funded research.</p>
</blockquote>
</div>
<div class="section level2">
<h2 id="map-1-covid-cases-in-washington-counties">Map 1: COVID Cases in Washington Counties<a class="anchor" aria-label="anchor" href="#map-1-covid-cases-in-washington-counties"></a>
</h2>
<p>The first map we will recreate is the map of new cases in Washington
state (by county). We define new cases to be a 7-day rolling average of
confirmed cases of COVID-19 per 100k residents.</p>
<p>This is the map displayed on Opportunity Insights’ economic
tracker:</p>
<p><img src="./Opportunity_Insights_files/map1.PNG"></p>
<p>We observe that the tilted map for Washington uses a projection that
is appropriate for the continental US and any states intersecting
longitude -103.75 deg east. In contrast, the
<strong>MazamaSpatialPlots</strong> functions will chose the most
appropriate projection for each state or combination of states.</p>
<p>Using just the basic functionality of the <code><a href="../reference/countyMap.html">countyMap()</a></code>
function, we can make a map that is a reasonably closes match to the
original map:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mapDate</span> <span class="op">&lt;-</span> <span class="fu">lubridate</span><span class="fu">::</span><span class="fu"><a href="https://lubridate.tidyverse.org/reference/parse_date_time.html" class="external-link">parse_date_time</a></span><span class="op">(</span><span class="st">"2021 02 09"</span>, <span class="st">"y m d"</span>, tz <span class="op">=</span> <span class="st">"UTC"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># column 'new_case_rate' is the confirmed covid cases per 100k residents, 7-day rolling average</span></span>
<span><span class="va">countyCovid_formatted</span> <span class="op">&lt;-</span> <span class="va">countyCovid</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    date <span class="op">=</span> <span class="fu">lubridate</span><span class="fu">::</span><span class="fu"><a href="https://lubridate.tidyverse.org/reference/parse_date_time.html" class="external-link">parse_date_time</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="va">year</span>, <span class="va">month</span>, <span class="va">day</span><span class="op">)</span>, <span class="st">"y m d"</span>, tz <span class="op">=</span> <span class="st">"UTC"</span><span class="op">)</span>,</span>
<span>    countyFIPS <span class="op">=</span> <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_pad.html" class="external-link">str_pad</a></span><span class="op">(</span><span class="va">countyfips</span>, width <span class="op">=</span> <span class="fl">5</span>, pad <span class="op">=</span> <span class="st">"0"</span><span class="op">)</span>,</span>
<span>    stateCode <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/MazamaSpatialUtils/man/US_stateConversion.html" class="external-link">US_stateFIPSToCode</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/substr.html" class="external-link">substr</a></span><span class="op">(</span><span class="va">countyFIPS</span>, <span class="fl">0</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    new_case_rate <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">new_case_rate</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">date</span> <span class="op">==</span> <span class="va">mapDate</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">countyFIPS</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>meanCaseRate <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">new_case_rate</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">countyFIPS</span>, <span class="va">stateCode</span>, <span class="va">meanCaseRate</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/countyMap.html">countyMap</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">countyCovid_formatted</span>,</span>
<span>  parameter <span class="op">=</span> <span class="st">"meanCaseRate"</span>,</span>
<span>  stateCode <span class="op">=</span> <span class="st">"WA"</span>,</span>
<span>  breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">200</span>, <span class="fl">40</span><span class="op">)</span>,</span>
<span>  palette <span class="op">=</span> <span class="st">"YlOrBr"</span>,</span>
<span>  style <span class="op">=</span> <span class="st">"cont"</span>, <span class="co"># continuous color scale</span></span>
<span>  legendOrientation <span class="op">=</span> <span class="st">"horizontal"</span>,</span>
<span>  legendTitle <span class="op">=</span> <span class="st">""</span>,</span>
<span>  stateBorderColor <span class="op">=</span> <span class="st">"white"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><img src="Opportunity_Insights_files/figure-html/map1_basic-1.png" width="700"></p>
<p>We have chosen the <strong>RColorBrewer</strong> palette that seems
to be the best match for the original palette. It’s not perfect but it’s
close.</p>
<p>The other difference between the map created with
<code><a href="../reference/countyMap.html">countyMap()</a></code> and the original is the position of the legend.
We can add adjust this manually using functions provided by
<strong>tmap</strong>.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/countyMap.html">countyMap</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">countyCovid_formatted</span>,</span>
<span>  parameter <span class="op">=</span> <span class="st">"meanCaseRate"</span>,</span>
<span>  stateCode <span class="op">=</span> <span class="st">"WA"</span>,</span>
<span>  breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">200</span>, <span class="fl">40</span><span class="op">)</span>,</span>
<span>  palette <span class="op">=</span> <span class="st">"YlOrBr"</span>,</span>
<span>  style <span class="op">=</span> <span class="st">"cont"</span>, </span>
<span>  legendOrientation <span class="op">=</span> <span class="st">"horizontal"</span>,</span>
<span>  legendTitle <span class="op">=</span> <span class="st">""</span>,</span>
<span>  stateBorderColor <span class="op">=</span> <span class="st">"white"</span></span>
<span><span class="op">)</span> <span class="op">+</span> <span class="fu">tmap</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_layout.html" class="external-link">tm_layout</a></span><span class="op">(</span></span>
<span>    legend.position <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"center"</span>, <span class="st">"bottom"</span><span class="op">)</span>,</span>
<span>    legend.outside <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>    legend.outside.position <span class="op">=</span> <span class="st">"bottom"</span>,</span>
<span>    legend.outside.size <span class="op">=</span> <span class="fl">0.1</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><img src="Opportunity_Insights_files/figure-html/map1_fancy-1.png" width="700"></p>
<p>What story does this map tell? We can see that the average number of
new COVID-19 cases in Washington State continue to be highest in the
rural, farming counties of eastern Washington.</p>
</div>
<div class="section level2">
<h2 id="map-2-student-math-participation-in-new-york-counties">Map 2: Student Math Participation in New York Counties<a class="anchor" aria-label="anchor" href="#map-2-student-math-participation-in-new-york-counties"></a>
</h2>
<p>The next map we will recreate is the map of change in student
participation in Math in the state of New York (by county) aggregated at
the end of the week. This is the map displayed on Opportunity Insights’
economic tracker:</p>
<p><img src="./Opportunity_Insights_files/map2.PNG"></p>
<p>As before, we can use just the basic functionality
<strong>MazamaSpatialPlots</strong>’s <code><a href="../reference/countyMap.html">countyMap()</a></code> function
to make a map that comes close to matching the original map. One aspect
that <code><a href="../reference/countyMap.html">countyMap()</a></code> isn’t able to replicate is the color
palette used by Opportunity Insights. It appears to be some darker
variation of the Spectral palette provided by
<strong>RColorBrewer</strong> but we were unable to find an exact
match.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mapDate</span> <span class="op">&lt;-</span> <span class="fu">lubridate</span><span class="fu">::</span><span class="fu"><a href="https://lubridate.tidyverse.org/reference/parse_date_time.html" class="external-link">parse_date_time</a></span><span class="op">(</span><span class="st">"2021 02 07"</span>, <span class="st">"y m d"</span>, tz <span class="op">=</span> <span class="st">"UTC"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">countyMath_formatted</span> <span class="op">&lt;-</span> <span class="va">countyMath</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    date <span class="op">=</span> <span class="fu">lubridate</span><span class="fu">::</span><span class="fu"><a href="https://lubridate.tidyverse.org/reference/parse_date_time.html" class="external-link">parse_date_time</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="va">year</span>, <span class="va">month</span>, <span class="va">day_endofweek</span><span class="op">)</span>, <span class="st">"y m d"</span>, tz <span class="op">=</span> <span class="st">"UTC"</span><span class="op">)</span>,</span>
<span>    countyFIPS <span class="op">=</span> <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_pad.html" class="external-link">str_pad</a></span><span class="op">(</span><span class="va">countyfips</span>, width <span class="op">=</span> <span class="fl">5</span>, pad <span class="op">=</span> <span class="st">"0"</span><span class="op">)</span>,</span>
<span>    stateCode <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/MazamaSpatialUtils/man/US_stateConversion.html" class="external-link">US_stateFIPSToCode</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/substr.html" class="external-link">substr</a></span><span class="op">(</span><span class="va">countyFIPS</span>, <span class="fl">0</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    engagement <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">engagement</span><span class="op">)</span> <span class="op">*</span> <span class="fl">100.0</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">date</span> <span class="op">==</span> <span class="va">mapDate</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/countyMap.html">countyMap</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">countyMath_formatted</span>,</span>
<span>  parameter <span class="op">=</span> <span class="st">"engagement"</span>,</span>
<span>  stateCode <span class="op">=</span> <span class="st">"NY"</span>,</span>
<span>  breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="op">-</span><span class="fl">100</span>, <span class="fl">0</span>, <span class="fl">20</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">40</span>, <span class="fl">200</span>, <span class="fl">40</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  palette <span class="op">=</span> <span class="st">"Spectral"</span>,</span>
<span>  style <span class="op">=</span> <span class="st">"cont"</span>,</span>
<span>  legendOrientation <span class="op">=</span> <span class="st">"horizontal"</span>,</span>
<span>  legendTitle <span class="op">=</span> <span class="st">""</span>,</span>
<span>  stateBorderColor <span class="op">=</span> <span class="st">"white"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><img src="Opportunity_Insights_files/figure-html/map2_basic-1.png" width="700"></p>
<p>Similarly to the previous example, we can adjust the position of the
legend manually by using <strong>tmap</strong>. We can also add the
percent (%) symbol at the end of each label in the legend. Finally, we
will take the liberty of choosing a diverging color palette that better
conveys which counties show increased or decreased engagement.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">breaks</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="op">-</span><span class="fl">100</span>, <span class="fl">0</span>, <span class="fl">20</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">40</span>, <span class="fl">200</span>, <span class="fl">40</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/countyMap.html">countyMap</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">countyMath_formatted</span>,</span>
<span>  parameter <span class="op">=</span> <span class="st">"engagement"</span>,</span>
<span>  stateCode <span class="op">=</span> <span class="st">"NY"</span>,</span>
<span>  breaks <span class="op">=</span> <span class="va">breaks</span>,</span>
<span>  palette <span class="op">=</span> <span class="st">"RdBu"</span>,</span>
<span>  style <span class="op">=</span> <span class="st">"cont"</span>,</span>
<span>  legendOrientation <span class="op">=</span> <span class="st">"horizontal"</span>,</span>
<span>  legendTitle <span class="op">=</span> <span class="st">""</span>,</span>
<span>  stateBorderColor <span class="op">=</span> <span class="st">"white"</span></span>
<span><span class="op">)</span> <span class="op">+</span> <span class="fu">tmap</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_layout.html" class="external-link">tm_layout</a></span><span class="op">(</span></span>
<span>    legend.position <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"center"</span>, <span class="st">"bottom"</span><span class="op">)</span>,</span>
<span>    legend.outside <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>    legend.outside.position <span class="op">=</span> <span class="st">"bottom"</span>,</span>
<span>    legend.format <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>fun <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">x</span>, <span class="st">"%"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    legend.outside.size <span class="op">=</span> <span class="fl">0.1</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><img src="Opportunity_Insights_files/figure-html/map2_fancy-1.png" width="700"></p>
<p>Without additional information, no clear story emerges from this map.
But it does highlight several counties where additional information
might reveal why they had a significant increase or decrease in student
engagement.</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Jonathan Callahan, Rachel Carroll, Eli Grosman.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.6.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
